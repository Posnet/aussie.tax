<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Australian Tax Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            text-align: center;
        }
        .container {
            max-width: 1200px;
            padding: 20px;
            margin: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .flex-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .flex-item {
            flex: 1;
            padding: 10px;
            min-width: 280px;
            box-sizing: border-box;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
            height: 40px;
        }
        th {
            background-color: #f2f2f2;
        }
        .difference-positive {
            color: red;
        }
        .difference-negative {
            color: green;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Australian Tax Calculator</h1>
        <div class="form-group">
            <label for="income">Enter your annual income before tax:</label>
            <input type="number" id="income" placeholder="e.g., 60000" value="60000" oninput="updateTax()">
        </div>
        <table id="totalsTable">
            <thead>
                <tr>
                    <th>Scheme</th>
                    <th>Total Tax Payable</th>
                </tr>
            </thead>
            <tbody id="totalsBody"></tbody>
        </table>
        <div id="resultsContainer" class="flex-container"></div>
    </div>
    <script>
        const schemes = [
            {
                name: "Current Scheme (2023-24)",
                bands: [
                    [1, 18200, 0],
                    [18201, 45000, 0.19],
                    [45001, 120000, 0.325],
                    [120001, 180000, 0.37],
                    [180001, Infinity, 0.45]
                ]
            },
            {
                name: "New Scheme (2024-25)",
                bands: [
                    [1, 18200, 0],
                    [18201, 45000, 0.16],
                    [45001, 135000, 0.30],
                    [135001, 190000, 0.37],
                    [190001, Infinity, 0.45]
                ]
            },
            {
                name: "Cancelled Scheme",
                bands: [
                    [1, 18200, 0],
                    [18201, 45000, 0.19],
                    [45001, 200000, 0.30],
                    [],
                    [200001, Infinity, 0.45]
                ]
            }
        ];

        document.addEventListener("DOMContentLoaded", () => {
            generateTables();
            updateTax();
        });

        function generateTables() {
            const resultsContainer = document.getElementById("resultsContainer");
            resultsContainer.innerHTML = "";

            schemes.forEach((scheme, index) => {
                const table = document.createElement("table");
                table.id = `resultsTable${index + 1}`;
                table.classList.add("flex-item");

                const thead = `
                    <thead>
                        <tr>
                            <th colspan="2">${scheme.name}</th>
                        </tr>
                        <tr>
                            <th>Band</th>
                            <th>Tax Payable</th>
                        </tr>
                    </thead>
                `;

                const tbody = document.createElement("tbody");
                tbody.id = `resultsBody${index + 1}`;

                table.innerHTML = thead;
                table.appendChild(tbody);
                resultsContainer.appendChild(table);
            });
        }

        function updateTax() {
            const income = parseFloat(document.getElementById("income").value);
            const isValidIncome = !isNaN(income) && income > 0;

            const totalsBody = document.getElementById("totalsBody");
            totalsBody.innerHTML = "";

            const currentSchemeTotal = isValidIncome ? calculateTotalTax(income, schemes[0].bands) : 0;

            schemes.forEach((scheme, index) => {
                const taxDetails = isValidIncome ? calculateTax(income, scheme.bands) : initializeZeroTax(scheme.bands);

                const totalTax = taxDetails.reduce((total, band) => total + (band ? band.taxPayable : 0), 0);
                const resultsBody = document.getElementById(`resultsBody${index + 1}`);
                resultsBody.innerHTML = "";

                taxDetails.forEach(band => {
                    const row = document.createElement("tr");
                    if (band) {
                        const bandCell = document.createElement("td");
                        const taxCell = document.createElement("td");

                        const cents = band.rate <= 0 ? "(Tax Free)" : ` (${(band.rate * 100).toFixed(1)}Â¢)`;
                        bandCell.innerText = `${band.range} ${cents}`;
                        taxCell.innerText = formatCurrency(band.taxPayable);

                        row.appendChild(bandCell);
                        row.appendChild(taxCell);
                    } else {
                        row.innerHTML = "<td></td><td></td>";
                    }
                    resultsBody.appendChild(row);
                });

                const difference = totalTax - currentSchemeTotal;
                const differenceText = difference > 0 ? ` (+${formatCurrency(difference)})` : difference < 0 ? ` (${formatCurrency(difference)})` : "";
                const differenceClass = difference > 0 ? "difference-positive" : difference < 0 ? "difference-negative" : "";

                const totalRow = document.createElement("tr");
                totalRow.innerHTML = `
                    <td>${scheme.name}</td>
                    <td>${formatCurrency(totalTax)}<span class="${differenceClass}">${differenceText}</span></td>
                `;
                totalsBody.appendChild(totalRow);
            });
        }

        function calculateTax(income, bands) {
            let totalTax = 0;
            return bands.map(band => {
                if (band.length === 0) return null;
                const [start, end, rate] = band;
                if (income < start) return createTaxDetail(start, end, 0, rate);
                
                const taxableIncome = Math.min(income, end) - start + 1;
                const taxPayable = taxableIncome * rate;
                totalTax += taxPayable;
                return createTaxDetail(start, end, taxPayable, rate);
            });
        }

        function calculateTotalTax(income, bands) {
            return bands.reduce((total, band) => {
                if (band.length === 0) return total;
                const [start, end, rate] = band;
                if (income > start) {
                    const taxableIncome = Math.min(income, end) - start + 1;
                    return total + taxableIncome * rate;
                }
                return total;
            }, 0);
        }

        function createTaxDetail(start, end, taxPayable, rate) {
            return {
                range: `${formatCurrency(start)} - ${end === Infinity ? "and above" : formatCurrency(end)}`,
                taxPayable,
                rate
            };
        }

        function initializeZeroTax(bands) {
            return bands.map(band => band.length === 0 ? null : createTaxDetail(band[0], band[1], 0, band[2]));
        }

        function formatCurrency(amount) {
            return `$${amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, "$&,")}`;
        }

        function resetResults() {
            for (let i = 1; i <= schemes.length; i++) {
                document.getElementById(`resultsBody${i}`).innerHTML = "";
                document.getElementById(`totalScheme${i}`).innerText = "";
            }
        }
    </script>
</body>
</html>
